<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <script src="http://ajax.aspnetcdn.com/ajax/jQuery/jquery-1.8.0.js">
  </script>

  <title>Document</title>
</head>

<body>
  <div>
    <table>

      <tr>
        <td colspan="5">
          <h1>Directory</h1>
        </td>
        <td></td>
        <td></td>
        <td></td>
        <td></td>
        <td colspan="1"><input type="button" value="new contact" id="btnNewContact"></td>
      </tr>

    </table>
    <hr>
  </div>

  <div>
    <table border="1">

      <thead>
        <tr>
          <th>No.</th>
          <th>Name</th>
          <th>Phone</th>
          <th>Category</th>
          <th>Memo</th>
          <th colspan="2"></th>
        </tr>

      </thead>
      <tbody id="bodyContent">


      </tbody>
    </table>
  </div>

  <div id="tmplNewContract" style="display: none;">
    <table>
      <tr id="addNewContactHtml">
        <td>
          <span id="num"></span>
        </td>
        <td>
          <span class="name" style="display: none;"></span>
          <input class="inputName" type="text" placeholder="name">
        </td>
        <td>
          <span class="phone" style="display: none;"></span>
          <input class="inputPhone" type="text" placeholder="phone number">
        </td>
        <td>
          <span class="category" style="display: none;"></span>
          <select name="category" class="inputCategory">
            <!-- <option selected = "selected"  ></option> -->
            <option selected="selected" value="family">Family</option>
            <option value="friend">Friend</option>
            <option value="co-worker">Co-worker</option>
            <option value="teacher">Teacher</option>
            <option value="acquaitance">Acquaitance</option>
            <option value="classmate">Classmate</option>
          </select>
        </td>
        <td>
          <span class="memo" style="display: none;"></span>
          <textarea class="inputMemo" cols="30" rows="3" placeholder="輸入你想要寫的內容..."></textarea>
        </td>
        <td>
          <span class="btnsForDisplay" style="display: none;">
            <input type="button" value="Edit" id="edit">
            <input type="button" value="Remove" id="remove">
          </span>

          <span class="btnsForEdit">
            <input type="button" value="Save" id="btnSaveContact">
            <input type="button" value="Cancel" id="btnCancelEditing">
          </span>
        </td>
      </tr>
    </table>
  </div>

  <div id="templNoContact" style="display: none;">
    <tr id="noContactTr">
      <td colspan="7">No contact !</td>
    </tr>
  </div>
  <script>
    var name = "";
    var phone = "";
    var category = "";
    var memo = "";
    var contactList = [];

    $(document).ready(function () {

      registerNewContactButtonClickEvent();
      registerCancelEditingButtonClickEvent();
      registerSaveContactButtonClickEvent();
      registerRemoveContactClickEvent();
      registerEditContactClickEvent();
     
    });

    function registerNewContactButtonClickEvent() {
      $("#btnNewContact").click( function () {
        var trObj = $("#tmplNewContract tbody tr")[0].outerHTML;
        $("#bodyContent").append(trObj);
        $("#bodyContent").find("tr").addClass("newTr");
      })
    }

    function registerCancelEditingButtonClickEvent() {
      $("div").on("click", "#btnCancelEditing", function () {
        var tr = $(this).closest("tr");
        tr.find("#num");
        tr.remove();

        $(tr).find("span").show();
        $(tr).find(".btnsForDisplay").show();
        $(tr).find(":text").hide();
        $(tr).find(".inputCategory").hide();
        $(tr).find(".inputMemo").hide();
        $(tr).find(".btnsForEdit").hide();
      });
    }


    function registerRemoveContactClickEvent() {
      $("div").on("click", "#remove", function (event) {
        var answer = confirm("Are you sure you want to delete this contact info?");
        if (answer == true) {
          var tr = $(this).closest("tr");
          var index = tr.find("#num").text();
          contactList[index-1]
          contactList.splice(index-1,1);
          displayContacts();
       
        } else {
          //do nothing
        }

      });

    }
//首次save
    function registerSaveContactButtonClickEvent() {

      $("div").on("click", "#btnSaveContact", function () {
        //get value from input

        var tr3 = $(this).closest("tr");
        var itemNumber
        name = tr3.find(".inputName").val();
        phone = tr3.find(".inputPhone").val();
        category = tr3.find(".inputCategory").val();
        memo = tr3.find(".inputMemo").val();
        //filter the value isn't null
        var contact = {};

        console.log(contact);
        contact['name'] = name;
        contact['phone'] = phone;
        contact['category'] = category;
        contact['memo'] = memo;

        // add contact to contactList

        contactList.push(contact);
        console.log("after adding value to obj ");
        console.log(contact);
        console.log(contactList);
        //set value to display text mode

        itemNumber = contactList.length;

        console.log("itemNumber:" + itemNumber);
        var num = tr3.find("#num").text();
        // console.log("num="+num);
        if (tr3.find("#num").text().length == 0) {
          tr3.find("#num").text(itemNumber);
        }

        tr3.find(".name").text(name);
        tr3.find(".phone").text(phone);
        tr3.find(".category").text(category);
        tr3.find(".memo").text(memo);
        //change to display mode
        $(tr3).find(":text").hide();
        $(tr3).find("span").show();
        $(tr3).find(".inputCategory").hide();
        $(tr3).find(".inputMemo").hide();
        $(tr3).find(".btnsForDisplay").show();
        $(tr3).find(".btnsForEdit").hide();

      });

    }

    function registerEditContactClickEvent() {

      var name = "";
      var phone = "";
      var category = "";
      var memo = "";

      $("div").on('click', '#edit', function (event) {
        var tr = $(this).closest("tr");
        $(tr).find("span").hide();
        $(tr).find(".btnsForDisplay").hide();
        $(tr).find(":text").show();
        $(tr).find(".inputCategory").show();
        $(tr).find(".inputMemo").show();
        $(tr).find(".btnsForEdit").show();
        $(tr).find(".num").show();

        name = tr.find(".name").text();
        phone = tr.find(".phone").text();
        category = tr.find(".category").text();
        memo = tr.find(".memo").text();
        //set value to input mode
        $(tr).find(".inputName").val(name);
        $(tr).find(".inputPhone").val(phone);
        $(tr).find(".inputCategory").val(category);
        $(tr).find(".inputMemo").val(memo);

      });
    }


    function displayContacts(){
      $("#bodyContent").empty();
      for(i = 0;i<contactList.length;i++){
        var contactObject = contactList[i];
        var trObj = $("#tmplNewContract tbody tr")[0].outerHTML;
  
        $("#bodyContent").append(trObj);
        $("#bodyContent").find("tr").addClass("newTr");
        console.log("contact index = " + i )
        console.log(contactList[i]);
        console.log(contactObject.name);
        var tr = $("#bodyContent tr")[i];
        console.log(tr);
        $(tr).find("#num").text(i + 1);
        $(tr).find(".name").text(contactObject.name);
        $(tr).find(".phone").text(contactObject.phone);
        $(tr).find(".category").text(contactObject.category);
        $(tr).find(".memo").text(contactObject.memo);
      }

  
        $(".newTr").find(":text").hide();
        $(".newTr").find(".name").show();
        $(".newTr").find(".phone").show();
        $(".newTr").find(".category").show();
        $(".newTr").find(".memo").show();
        $(".newTr").find(".inputCategory").hide();
        $(".newTr").find(".inputMemo").hide();
        $(".newTr").find(".btnsForDisplay").show();
        $(".newTr").find(".btnsForEdit").hide();
  
    }

    // function registerSaveContactClickEvent(){
    //     //save contact 
    //     $("div").on("click","#btnCreateNewContact", function () {
    //       //get value from input

    //       var tr3 = $(this).closest("tr");
    //       name = tr3.find(".inputName").val();
    //       phone = tr3.find(".inputPhone").val();
    //       category = tr3.find(".inputCategory").val();
    //       memo = tr3.find(".inputMemo").val();
    //       //check value isn't plain
    //       if (name.length == 0) {
    //         alert("plz input the contact name!");
    //         return;
    //       }
    //       if (phone.length == 0) {
    //         alert("plz input the contact phone!");
    //         return;
    //       }


    //       //set value to display text mode
    //       tr3.find(".name").text(name);
    //       tr3.find(".phone").text(phone);
    //       tr3.find(".category").text(category);
    //       tr3.find(".memo").text(memo);
    //       //change to display mode
    //       $(tr3).find(":text").hide();
    //       $(tr3).find("span").show();
    //       $(tr3).find(".inputCategory").hide();
    //       $(tr3).find(".inputMemo").hide();
    //       $(tr3).find(".btnsForDisplay").show();
    //       $(tr3).find(".btnsForEdit").hide();
          
    //     });
    // }



  </script>
</body>

</html>